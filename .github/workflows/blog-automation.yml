name: üöÄ Blog Deployment Check

on:
  push:
    branches: [main]

jobs:
  # ÏΩîÎìú ÌíàÏßà Í≤ÄÏÇ¨ (main Î∏åÎûúÏπò push Ïãú)
  code-quality:
    name: Code Quality Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Run type check
        run: npm run type-check

      - name: Run linter
        run: npm run lint

      - name: Build project
        run: npm run build

  # SEO Î∞è ÏÑ±Îä• Í≤ÄÏÇ¨ (Î∞∞Ìè¨ ÌõÑ)
  seo-performance-check:
    name: SEO and Performance Check
    runs-on: ubuntu-latest
    needs: code-quality
    steps:
      - name: Wait for deployment
        run: sleep 90

      - name: Check sitemap
        run: |
          curl -f https://mykim.in/sitemap.xml || exit 1
          echo "‚úÖ Sitemap is accessible"

      - name: Check robots.txt
        run: |
          curl -f https://mykim.in/robots.txt || exit 1
          echo "‚úÖ Robots.txt is accessible"

      - name: Check RSS feed
        run: |
          curl -f https://mykim.in/rss.xml || exit 1
          echo "‚úÖ RSS feed is accessible"

      - name: Check main page
        run: |
          curl -f https://mykim.in/ || exit 1
          echo "‚úÖ Main page is accessible"

      - name: Check page load time
        run: |
          response_time=$(curl -o /dev/null -s -w '%{time_total}' https://mykim.in/)
          echo "Page load time: ${response_time}s"
          if (( $(echo "$response_time > 3.0" | bc -l) )); then
            echo "‚ö†Ô∏è Page load time is slow: ${response_time}s"
          else
            echo "‚úÖ Page load time is good: ${response_time}s"
          fi
